"""Tests for the APO function."""
import taleb

import math

import numpy as np

from .data import create_dataset


def test_APO():
    df = create_dataset()
    result = taleb.APO(df["Close"].to_numpy())
    expected = np.array([
                math.nan,         math.nan,         math.nan,         math.nan,         math.nan,
               math.nan,         math.nan,         math.nan,         math.nan,         math.nan,
               math.nan,         math.nan,         math.nan,         math.nan,         math.nan,
               math.nan,         math.nan,         math.nan,         math.nan,         math.nan,
               math.nan,         math.nan,         math.nan,         math.nan,         math.nan,
       -0.05180478,  0.0040069 ,  0.01155204,  0.00820021,  0.04685311,
        0.06101991,  0.0759327 ,  0.05514415,  0.06593417,  0.07741079,
        0.03179518,  0.00668631, -0.00792471, -0.03367425, -0.07531677,
       -0.09662928, -0.06881561, -0.04359093, -0.04780472, -0.08291067,
       -0.08234667, -0.06651843, -0.00962722, -0.00488613,  0.03984255,
        0.06804485,  0.0965338 ,  0.1459597 ,  0.11519919,  0.1134127 ,
        0.11793453,  0.07804086,  0.02891277,  0.06554478,  0.01484002,
       -0.0105452 , -0.08410604, -0.06363424, -0.07463644, -0.11359105,
       -0.06869502, -0.07455772, -0.09874373, -0.13818375, -0.10364836,
       -0.04549187,  0.0157454 , -0.01002879,  0.04481404,  0.06063017,
        0.05863167,  0.0376792 ,  0.01630246,  0.01430602,  0.01777288,
        0.03585616,  0.00139371,  0.00375339, -0.02157086, -0.04280548,
       -0.07093193, -0.06745183, -0.10353   , -0.08176822, -0.02900963,
       -0.02831925,  0.02441053,  0.01770054, -0.00692333, -0.00647923,
       -0.01353016,  0.02328313,  0.07866732,  0.05207972,  0.06034835
    ])
    np.testing.assert_almost_equal(expected, result)
